!function(){function e(e,n){var a;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,n){if(!e)return;if("string"==typeof e)return t(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return t(e,n)}(e))||n&&e&&"number"==typeof e.length){a&&(e=a);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,s=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return c=e.done,e},e:function(e){s=!0,i=e},f:function(){try{c||null==a.return||a.return()}finally{if(s)throw i}}}}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function r(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{n9R2:function(t,a,o){"use strict";o.r(a),o.d(a,"ExportModule",(function(){return B}));var i,c=o("ofXK"),s=o("5HBU"),l=o("sYmb"),d=o("wd/R"),u={lang:"en",data:{SAMPLE:{HELLO:"Hello, World!"},FORM_FIELD:{LABEL:{DATE_RANGE:"Enter a date range (Optional)",DATABASE:"Database",FIELDS:"Fields",SORT_BY:"Sort by",EXPORT:"Export",INCLUDE_METADATA:"Include Metadata",BLUEPRINT_MARKED:"Metadata marked in Blueprint"},DATE_PICKER:{TITLE:{DATE_RANGE:"Date Range (Optional): "}},INPUT:{PLACEHOLDER:{SEARCH_FOR_FORM:"Search for form",START_DATE:"Start date",END_DATE:"End date",FIELDS:"Enter field separated by comma with space behind, eg: timestamp, matingChamber",SORT_BY:"Enter sorts separated by comma with space behind, eg: timestamp:desc, matingChamber:asc"}},SELECT:{OPTION:{CSV:"Export CSV",SHEET:"Export to Google Sheet"}},HINT:{EXAMPLE:"eg:"}},BUTTON:{EXPORT:"Export"}}},p={lang:"my",data:{SAMPLE:{HELLO:"Hello, World!"},FORM_FIELD:{LABEL:{DATE_RANGE:"Masukkan julat tarikh (Tidak Wajib)",DATABASE:"Pangkalan data",FIELDS:"Bidang",SORT_BY:"Disusun mengikut",EXPORT:"Eksport",INCLUDE_METADATA:"Masukkan Metadata",BLUEPRINT_MARKED:"Metadata ditandai dalam Pelan Tindakan"},DATE_PICKER:{TITLE:{DATE_RANGE:"Julat Tarikh (Tidak Wajib): "}},INPUT:{PLACEHOLDER:{SEARCH_FOR_FORM:"Cari borang",START_DATE:"Tarikh mula",END_DATE:"Tarikh tamat",FIELDS:"Masukkan medan yang dipisahkan dengan koma dengan ruang di belakang, misalnya: timestamp, matingChamber",SORT_BY:"Masukkan disusun mengikut dengan dipisahkan dengan koma dengan ruang di belakang, misalnya: timestamp:desc, matingChamber:asc"}},SELECT:{OPTION:{CSV:"Eksport CSV",SHEET:"Eksport ke Google Sheet"}},HINT:{EXAMPLE:"Misalnya:"}},BUTTON:{EXPORT:"Eksport"}}},f=o("FKr1"),b=o("1yaQ"),h=o("fXoL"),m=o("tk/3"),E=((i=function(){function e(t){n(this,e),this.http=t}return r(e,[{key:"exportCsv",value:function(e){return this.http.post("/api/export",e,{responseType:"text"})}},{key:"getNotification",value:function(){return this.http.get("/api/notification",{headers:{skipLoading:"true"}})}}]),e}()).\u0275fac=function(e){return new(e||i)(h.Yb(m.b))},i.\u0275prov=h.Kb({token:i,factory:i.\u0275fac,providedIn:"root"}),i),g=o("7Wwi"),T=o("gPJw"),L=o("dNgK"),y=o("XiUz"),M=o("NFeN"),O=o("qFsG"),A=o("3Pt+"),C=o("/1cH"),D=o("kmnG"),x=o("iadO"),v=o("d3UM"),F=o("bSwM"),k=o("bTqV");function S(e,t){if(1&e&&(h.Ub(0,"span"),h.Lc(1),h.Tb()),2&e){var n=h.gc().$implicit;h.Cb(1),h.Nc("(",n.line,")")}}function _(e,t){if(1&e&&(h.Ub(0,"mat-option",28),h.Lc(1),h.Jc(2,S,2,1,"span",29),h.Tb()),2&e){var n=t.$implicit;h.nc("value",n),h.Cb(1),h.Nc(" ",n.form," "),h.Cb(1),h.nc("ngIf",n.line)}}var I,R,U={parse:{dateInput:"LL"},display:{dateInput:"DD/MMM/YYYY",monthYearLabel:"MMM YYYY",dateA11yLabel:"LL",monthYearA11yLabel:"MMMM YYYY"}},w=((I=function(){function t(e,a,r,o,i){n(this,t),this._exportService=e,this.formSelectionService=a,this.changeDetector=r,this._fuseTranslationLoaderService=o,this.snackBar=i,this.filteredForm=[],this.forms=[],this.exportType="GSheet",this.database="insectdata",this.fields="",this.sorts="submission_timestamp:desc",this.includeMetadata=!1,this._fuseTranslationLoaderService.loadTranslations(u,p)}return r(t,[{key:"ngOnInit",value:function(){this.getForms()}},{key:"getForms",value:function(){var e=this;this.formSelectionService.getForms().subscribe((function(t){e.apiOutput=t,e.addId()}))}},{key:"addId",value:function(){this.forms.push({id:0,form:"Export ALL",line:"",form_version:""});var t,n=1,a=e(this.apiOutput);try{for(a.s();!(t=a.n()).done;){var r=t.value;r.id=n,n+=1,this.forms.push(r)}}catch(o){a.e(o)}finally{a.f()}this.filteredForm=this.forms,this.changeDetector.detectChanges(),this.focusSearch()}},{key:"filterMyOptions",value:function(e){this.selectedForm=void 0,this.filteredForm=this.forms.filter((function(t){return t.id.toString().indexOf(e)>-1||t.form.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1}))}},{key:"displayWith",value:function(e){return e?e.form:""}},{key:"selectForm",value:function(e){this.selectedForm=e,this.selectedForm&&"Export ALL"===this.selectedForm.form&&(this.exportType="GSheet")}},{key:"focusSearch",value:function(){document.getElementById("searchInput").focus()}},{key:"generateBody",value:function(){var e,t=this,n="",a=!1,r=d().utcOffset("+8").format("HHmmss_DDMMyy");this.selectedForm&&"Export ALL"===this.selectedForm.form?(a=!0,r+="-all_form"):(n="workstationForm=".concat(this.selectedForm.form,", productionLine=").concat(this.selectedForm.line),r+="-".concat(this.selectedForm.line,"_").concat(this.selectedForm.form)),null!=this.startDate&&(n=n+", submission_timestamp>="+this.startDate.startOf("day").utcOffset("+8").toISOString(),null!=this.endDate&&(n=n+", submission_timestamp<="+this.endDate.endOf("day").utcOffset("+8").toISOString()));var o="";null!=this.startDate&&(o="-"+this.startDate.format("DDMMyy"),null!=this.endDate&&(o=o+"_to_"+this.endDate.format("DDMMyy")),r+=o);var i={exportAll:a,filename:r,type:this.exportType,database:this.database,selectors:n,fields:this.fields,sort:this.sorts,includeMetadata:this.includeMetadata};a&&(e=this.forms.splice(0,1),i.availableForms=this.forms),this._exportService.exportCsv(i).subscribe((function(e){t.snackBar.open("Exporting Data","Close",{duration:2e3})}),(function(e){console.log(e),t.snackBar.open(e.error)})),a&&this.forms.splice(0,0,e[0])}},{key:"closeCalendar",value:function(e){console.log(e)}}]),t}()).\u0275fac=function(e){return new(e||I)(h.Ob(E),h.Ob(g.a),h.Ob(h.h),h.Ob(T.a),h.Ob(L.a))},I.\u0275cmp=h.Ib({type:I,selectors:[["app-export"]],features:[h.Bb([{provide:f.c,useClass:b.c,deps:[f.f,b.a]},{provide:f.e,useValue:U}])],decls:54,vars:45,consts:[[1,"page-layout","simple","fullwidth"],[1,"content","p-24"],["fxLayout","row",2,"padding","5%"],["fxLayout","column","fxFlex","100"],["fxLayout","row","fxLayoutAlign","center center","fxFlex","",1,"ml-sm-32"],[1,"search-wrapper","mt-16","mt-sm-0"],["fxFlex","","fxLayout","row","fxLayoutAlign","start center",1,"search"],["matInput","","id","searchInput",3,"ngModel","placeholder","matAutocomplete","ngModelChange"],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["fxLayout","column","fxFlex","",1,"ml-sm-32"],["fxLayout","row"],["appearance","outline","fxFlex","50",2,"margin-right","1%"],[3,"rangePicker","click"],["tabindex","-1","readonly","","matStartDate","",3,"ngModel","placeholder","ngModelChange"],["tabindex","-1","readonly","","matEndDate","",3,"ngModel","placeholder","ngModelChange"],["matSuffix","",3,"for","focusin"],[3,"keydown.enter"],["picker",""],["appearance","outline","fxFlex","50",2,"margin-left","1%"],["name","export",3,"ngModel","disabled","ngModelChange"],["value","GSheet"],["value","csv"],["fxLayout","column",2,"margin-bottom","12px"],[3,"ngModel","ngModelChange"],[2,"font-size","smaller"],["mat-raised-button","","color","accent","fxFlex","10",3,"disabled","click"],[3,"value"],[4,"ngIf"]],template:function(e,t){if(1&e){var n=h.Vb();h.Ub(0,"div",0),h.Ub(1,"div",1),h.Ub(2,"div",2),h.Ub(3,"div",3),h.Ub(4,"div",4),h.Ub(5,"div",5),h.Ub(6,"div",6),h.Ub(7,"mat-icon"),h.Lc(8,"search"),h.Tb(),h.Ub(9,"input",7),h.cc("ngModelChange",(function(e){return t.searchWord=e}))("ngModelChange",(function(e){return t.filterMyOptions(e)})),h.hc(10,"translate"),h.Tb(),h.Ub(11,"mat-autocomplete",8,9),h.cc("optionSelected",(function(e){return t.selectForm(e.option.value)})),h.Jc(13,_,3,3,"mat-option",10),h.Tb(),h.Tb(),h.Tb(),h.Tb(),h.Ub(14,"div",11),h.Ub(15,"h3"),h.Lc(16),h.hc(17,"translate"),h.Tb(),h.Ub(18,"div",12),h.Ub(19,"mat-form-field",13),h.Ub(20,"mat-label"),h.Lc(21),h.hc(22,"translate"),h.Tb(),h.Ub(23,"mat-date-range-input",14),h.cc("click",(function(){return h.yc(n),h.uc(30).open()})),h.Ub(24,"input",15),h.cc("ngModelChange",(function(e){return t.startDate=e})),h.hc(25,"translate"),h.Tb(),h.Ub(26,"input",16),h.cc("ngModelChange",(function(e){return t.endDate=e})),h.hc(27,"translate"),h.Tb(),h.Tb(),h.Ub(28,"mat-datepicker-toggle",17),h.cc("focusin",(function(){return h.yc(n),h.uc(30).open()})),h.Tb(),h.Ub(29,"mat-date-range-picker",18,19),h.cc("keydown.enter",(function(e){return t.closeCalendar(e)})),h.Tb(),h.Tb(),h.Lc(31," \xa0 "),h.Ub(32,"mat-form-field",20),h.Ub(33,"mat-label"),h.Lc(34),h.hc(35,"translate"),h.Tb(),h.Ub(36,"mat-select",21),h.cc("ngModelChange",(function(e){return t.exportType=e})),h.Ub(37,"mat-option",22),h.Lc(38),h.hc(39,"translate"),h.Tb(),h.Ub(40,"mat-option",23),h.Lc(41),h.hc(42,"translate"),h.Tb(),h.Tb(),h.Tb(),h.Tb(),h.Ub(43,"div",24),h.Ub(44,"mat-checkbox",25),h.cc("ngModelChange",(function(e){return t.includeMetadata=e})),h.Lc(45),h.hc(46,"translate"),h.Tb(),h.Ub(47,"span",26),h.Lc(48),h.hc(49,"translate"),h.Tb(),h.Tb(),h.Ub(50,"div",12),h.Ub(51,"button",27),h.cc("click",(function(){return t.generateBody()})),h.Lc(52),h.hc(53,"translate"),h.Tb(),h.Tb(),h.Tb(),h.Tb(),h.Tb(),h.Tb(),h.Tb()}if(2&e){var a=h.uc(12),r=h.uc(30);h.Cb(9),h.oc("placeholder",h.ic(10,23,"FORM_FIELD.INPUT.PLACEHOLDER.SEARCH_FOR_FORM")),h.nc("ngModel",t.searchWord)("matAutocomplete",a),h.Cb(2),h.nc("displayWith",t.displayWith),h.Cb(2),h.nc("ngForOf",t.filteredForm),h.Cb(3),h.Mc(h.ic(17,25,"FORM_FIELD.DATE_PICKER.TITLE.DATE_RANGE")),h.Cb(5),h.Mc(h.ic(22,27,"FORM_FIELD.LABEL.DATE_RANGE")),h.Cb(2),h.nc("rangePicker",r),h.Cb(1),h.oc("placeholder",h.ic(25,29,"FORM_FIELD.INPUT.PLACEHOLDER.START_DATE")),h.nc("ngModel",t.startDate),h.Cb(2),h.oc("placeholder",h.ic(27,31,"FORM_FIELD.INPUT.PLACEHOLDER.END_DATE")),h.nc("ngModel",t.endDate),h.Cb(2),h.nc("for",r),h.Cb(6),h.Mc(h.ic(35,33,"FORM_FIELD.LABEL.EXPORT")),h.Cb(2),h.nc("ngModel",t.exportType)("disabled",t.selectedForm&&"Export ALL"===t.selectedForm.form),h.Cb(2),h.Nc(" ",h.ic(39,35,"FORM_FIELD.SELECT.OPTION.SHEET")," "),h.Cb(3),h.Nc(" ",h.ic(42,37,"FORM_FIELD.SELECT.OPTION.CSV")," "),h.Cb(3),h.nc("ngModel",t.includeMetadata),h.Cb(1),h.Nc(" ",h.ic(46,39,"FORM_FIELD.LABEL.INCLUDE_METADATA")," "),h.Cb(3),h.Nc("* ",h.ic(49,41,"FORM_FIELD.LABEL.BLUEPRINT_MARKED"),""),h.Cb(3),h.nc("disabled",!t.selectedForm||!t.database||!t.exportType),h.Cb(1),h.Nc(" ",h.ic(53,43,"BUTTON.EXPORT")," ")}},directives:[y.c,y.a,y.b,M.a,O.b,A.d,C.c,A.s,A.v,C.a,c.s,D.c,D.g,x.d,x.l,x.k,x.j,D.i,x.e,v.a,f.o,F.a,k.b,c.t],pipes:[l.c],styles:[".search-wrapper[_ngcontent-%COMP%]{background-color:#fff;width:100%;max-width:480px;border-radius:28px;overflow:hidden;box-shadow:0 2px 1px -1px rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 1px 3px 0 rgba(0,0,0,.12)}.search-wrapper[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{width:100%;height:48px;line-height:48px;padding:0 18px}.search-wrapper[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;height:48px;min-height:48px;max-height:48px;padding:0 16px;border:none;outline:none}"]}),I),P=o("tyNb"),N=[{path:"",component:w}],B=((R=function e(){n(this,e)}).\u0275mod=h.Mb({type:R}),R.\u0275inj=h.Lb({factory:function(e){return new(e||R)},imports:[[c.c,P.l.forChild(N),l.b,s.a,C.b,M.b,x.i,D.e,O.c,v.b,k.c,F.b]]}),R)}}])}();