(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{rz4i:function(t,e,o){"use strict";o.r(e),o.d(e,"DashboardSopModule",(function(){return Z}));var n=o("ofXK"),i=o("3Pt+"),c=o("XNiG"),a=o("PqYM"),r=o("eIep"),d=o("un/a"),l=o("w1tV"),s=o("1G5W"),p=o("PVWW"),b=o("wd/R"),h=o("fXoL"),v=o("tk/3"),m=o("4WDQ"),f=o("tyNb"),u=o("hw3O"),g=o("Rea6"),x=o("sYmb");let y=(()=>{class t{constructor(t,e,o,n){this.http=t,this.snack=e,this.translate=o,this.global=n}get prefix(){return this.global.storagePrefix+"CACHE-"}hasCache(t){return!!localStorage.getItem(this.prefix+t)}getCache(t){let e=localStorage.getItem(this.prefix+t);return JSON.parse(e)}setCache(t,e){let o=JSON.stringify(e);return localStorage.setItem(this.prefix+t,o)}}return t.\u0275fac=function(e){return new(e||t)(h.Yb(v.b),h.Yb(g.a),h.Yb(x.d),h.Yb(m.a))},t.\u0275prov=h.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var C=o("X3qz"),O=o("EwFO"),w=o("XiUz"),F=o("kmnG"),L=o("qFsG"),T=o("iadO"),U=o("bTqV"),k=o("FtGj"),S=o("/1cH"),P=o("A5z7"),z=o("NFeN"),D=o("FKr1");const I=["inputFilter"];function A(t,e){if(1&t){const t=h.Vb();h.Ub(0,"mat-chip",8),h.cc("removed",(function(){h.yc(t);const o=e.$implicit;return h.gc().remove(o)})),h.Lc(1),h.Ub(2,"mat-icon",9),h.Lc(3,"cancel"),h.Tb(),h.Tb()}if(2&t){const t=e.$implicit;h.nc("selectable",!0)("removable",!0),h.Cb(1),h.Nc(" ",t.label," ")}}function V(t,e){if(1&t&&(h.Ub(0,"mat-option",10),h.Lc(1),h.Tb()),2&t){const t=e.$implicit;h.nc("value",t.value),h.Cb(1),h.Nc(" ",t.label," ")}}let $=(()=>{class t{constructor(){this.label="Choose a type",this.placeholder="SOP Types...",this.multiple=!1,this.options=[],this.separatorKeysCodes=[k.g,k.c],this.filterControl=new i.h,this.filteredOptions=[],this.selectedOptions=[]}ngOnInit(){this.subValueChanges(),this.filterOptions()}ngOnChanges(t){t.options&&t.options.currentValue&&(this.options=t.options.currentValue,this.filterOptions())}subValueChanges(){this.filterControl.valueChanges.subscribe(t=>{this.filterOptions(t)})}filterOptions(t){t=t||"",this.filteredOptions=this.options.filter(e=>{let o=e.label,n=e.value.toLocaleLowerCase().indexOf(t.toLocaleLowerCase())>-1,i=o.toLocaleLowerCase().indexOf(t.toLocaleLowerCase())>-1;return n||i})}selected(t){let e=this.form.value||[];e.push(t.option.value),this.form.setValue(e),this.refreshSelectedOptions(),this.openAutocompletePanel(),this.clearInput()}clearInput(){this.filterControl.reset(null),this.inputFilter.nativeElement.value=""}openAutocompletePanel(){setTimeout(()=>{this.inputAutocomplete.openPanel()},0)}remove(t){let e=this.form.value||[],o=e.indexOf(t.value);o>=0&&e.splice(o,1),this.form.setValue(e),this.refreshSelectedOptions()}refreshSelectedOptions(){let t=this.form.value||[];this.selectedOptions=this.options.filter(e=>t.includes(e.value))}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=h.Ib({type:t,selectors:[["app-filter-mat-chip"]],viewQuery:function(t,e){var o;1&t&&(h.Qc(S.c,!0,S.c),h.Qc(I,!0)),2&t&&(h.tc(o=h.dc())&&(e.inputAutocomplete=o.first),h.tc(o=h.dc())&&(e.inputFilter=o.first))},inputs:{label:"label",placeholder:"placeholder",form:"form",multiple:"multiple",options:"options"},features:[h.Ab],decls:14,vars:8,consts:[["appearance","outline",2,"width","100%"],["chipList",""],[3,"selectable","removable","removed",4,"ngFor","ngForOf"],[3,"placeholder","formControl","matAutocomplete","matChipInputFor","matChipInputSeparatorKeyCodes"],["inputAutocomplete","","inputFilter",""],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"selectable","removable","removed"],["matChipRemove",""],[3,"value"]],template:function(t,e){if(1&t&&(h.Ub(0,"mat-form-field",0),h.Ub(1,"mat-label"),h.Lc(2),h.Tb(),h.Ub(3,"mat-chip-list",null,1),h.Jc(5,A,4,3,"mat-chip",2),h.Pb(6,"input",3,4),h.Tb(),h.Ub(9,"mat-autocomplete",5,6),h.cc("optionSelected",(function(t){return e.selected(t)})),h.Jc(11,V,2,2,"mat-option",7),h.Tb(),h.Ub(12,"mat-error"),h.Lc(13,"Required"),h.Tb(),h.Tb()),2&t){const t=h.uc(4),o=h.uc(10);h.Cb(2),h.Mc(e.label),h.Cb(3),h.nc("ngForOf",e.selectedOptions),h.Cb(1),h.nc("placeholder",e.placeholder)("formControl",e.filterControl)("matAutocomplete",o)("matChipInputFor",t)("matChipInputSeparatorKeyCodes",e.separatorKeysCodes),h.Cb(5),h.nc("ngForOf",e.filteredOptions)}},directives:[F.c,F.g,P.c,n.s,i.d,S.c,P.b,i.s,i.i,S.a,F.b,P.a,z.a,P.d,D.o],styles:[""]}),t})();var K=o("Wp6s"),J=o("znSr");function j(t,e){if(1&t&&(h.Ub(0,"div"),h.Lc(1),h.Tb()),2&t){const t=e.$implicit,o=h.gc().$implicit,n=h.gc(4);h.Cb(1),h.Oc(" ",t.label,": ",n.getValue(o[t.value])," ")}}function G(t,e){if(1&t){const t=h.Vb();h.Ub(0,"div",20),h.cc("click",(function(){h.yc(t);const o=e.$implicit;return h.gc(4).onClickCard(o)})),h.Ub(1,"div",21),h.Jc(2,j,2,2,"div",11),h.Tb(),h.Tb()}if(2&t){const t=h.gc(2).$implicit;h.Cb(2),h.nc("ngForOf",t.data.template)}}function Y(t,e){if(1&t&&(h.Ub(0,"mat-card-content"),h.Ub(1,"div",18),h.Jc(2,G,3,1,"div",19),h.Tb(),h.Tb()),2&t){const t=h.gc().$implicit;h.Cb(2),h.nc("ngForOf",t.data.source)}}const M=function(t){return{"mat-card-title-slim":t}};function N(t,e){if(1&t&&(h.Ub(0,"div",15),h.Ub(1,"mat-card"),h.Ub(2,"mat-card-header"),h.Ub(3,"mat-card-title",16),h.Lc(4),h.Tb(),h.Tb(),h.Jc(5,Y,3,1,"mat-card-content",17),h.Tb(),h.Tb()),2&t){const t=e.$implicit;h.Cb(3),h.nc("title",t.key||"form not ready")("ngClass",h.qc(6,M,!t.data.source.length)),h.Cb(1),h.Pc(" ",t.id," ",t.label," (",t.data.source.length,") "),h.Cb(1),h.nc("ngIf",t.data.source.length)}}function R(t,e){if(1&t&&(h.Ub(0,"div"),h.Ub(1,"div",12),h.Ub(2,"div",13),h.Lc(3),h.Tb(),h.Tb(),h.Jc(4,N,6,8,"div",14),h.Tb()),2&t){const t=e.$implicit;h.Cb(3),h.Mc(t.label),h.Cb(1),h.nc("ngForOf",t.sops)}}let q=(()=>{class t{constructor(t,e,o,n,i,a){this.http=t,this.global=e,this.router=o,this.formService=n,this.cache=i,this.options=a,this.data=[],this.form=this.getForm(),this.stopPolling=new c.a,this.cacheKey="dashboard-sop",this.productionLineOptions=[],this._unsubscribeAll=new c.a}ngOnInit(){this.form.valueChanges.subscribe(t=>this.onChangeFormValue(t)),this.startPolling(),this.global.scheduleDashboardRefresh(),this.global.dashboardRefreshSubject.subscribe(()=>{this.setDateFilterToday()}),this.setFormTypeOptions()}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete(),this.stopPolling.next(),this.global.stopDashboardRefresh()}setFormTypeOptions(){this.options.fetchFormTypeOptions().subscribe(t=>{this.productionLineOptions=t})}setCacheFilter(){this.cache.hasCache(this.cacheKey)&&this.form.setValue(this.cache.getCache(this.cacheKey))}startPolling(){this.polling=Object(a.a)(1,15e3).pipe(Object(r.a)(()=>this.fetchData()),Object(d.a)(),Object(l.a)(),Object(s.a)(this.stopPolling)),this.polling.subscribe(t=>this.handleData(t))}fetchData(){let t=`/api/${this.global.tenant}/dashboard/dashboard-sop`,e=this.getBody(),o=this.getOptions();return this.http.post(t,e,o)}getBody(){let t=this.form.controls,e=t.date.value,o=b(e).add(24,"hours"),n=t.productionLines.value,i={timestamp:{}};return i.timestamp.$gte=e,i.timestamp.$lt=o,i.dataRecord={},i.dataRecord.$eq=!0,n&&n.length>0&&(i.productionLine={},i.productionLine.$in=n),{selector:i}}getOptions(){return{headers:this.getHeaders(),params:this.getParams()}}getParams(){return{}}getHeaders(){return{skipLoading:"true"}}handleData(t){this.data=t}handleError(t){console.log(t)}getValue(t){return this.isISO8601(t)?b(t).format("DD MMM YYYY, HH:mm:ss"):t}getForm(){return new i.k({date:new i.h(this.getStartDay()),productionLines:new i.h})}getStartDay(){return b().startOf("day")}onChangeFormValue(t){this.cache.setCache(this.cacheKey,t),this.fetchData().subscribe(t=>this.handleData(t),t=>this.handleError(t))}isISO8601(t){return!!/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z/.test(t)&&new Date(t).toISOString()===t}onClickCard(t){let e=`/forms/type/${t.productionLine}/${t.workstationForm}/edit`;this.formService.selectedId=t._id,this.formService.goBackUsingLocation=!0,this.router.navigateByUrl(e)}setDateFilterToday(){this.form.get("date").setValue(this.getStartDay())}}return t.\u0275fac=function(e){return new(e||t)(h.Ob(v.b),h.Ob(m.a),h.Ob(f.h),h.Ob(u.a),h.Ob(y),h.Ob(C.a))},t.\u0275cmp=h.Ib({type:t,selectors:[["app-dashboard-sop"]],decls:17,vars:6,consts:[["fusePerfectScrollbar","",1,"page-layout","blank","p-24"],["fxLayout","column"],["fxLayout","row","fxLayoutGap","24px",3,"formGroup"],["fxLayout","row","fxLayoutGap","12px","fxFlex",""],["appearance","outline","fxFlex",""],["matInput","","formControlName","date",3,"matDatepicker"],["matSuffix","",3,"for"],["picker",""],[2,"padding","0.25em 0.25em calc(21.5px + 0.25em) 0.25em"],["mat-raised-button","","fxFill","","color","accent",3,"click"],["fxFlex","",3,"form","options"],[4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","start center",1,"pb-16"],[1,"h2","secondary-text"],["class","pb-8",4,"ngFor","ngForOf"],[1,"pb-8"],[3,"title","ngClass"],[4,"ngIf"],["fxLayout","row","fxLayoutGap","6px",2,"overflow-x","scroll"],["class","fuse-card","style","cursor: pointer; background-color: #F3F3F3;",3,"click",4,"ngFor","ngForOf"],[1,"fuse-card",2,"cursor","pointer","background-color","#F3F3F3",3,"click"],["fxLayout","column","fxLayoutAlign","start start",1,"p-8"]],template:function(t,e){if(1&t&&(h.Ub(0,"div",0),h.Ub(1,"div",1),h.Ub(2,"form",2),h.Ub(3,"div",3),h.Ub(4,"mat-form-field",4),h.Ub(5,"mat-label"),h.Lc(6,"Choose a date"),h.Tb(),h.Pb(7,"input",5),h.Pb(8,"mat-datepicker-toggle",6),h.Pb(9,"mat-datepicker",null,7),h.Tb(),h.Ub(11,"div",8),h.Ub(12,"button",9),h.cc("click",(function(){return e.setDateFilterToday()})),h.Lc(13," Today "),h.Tb(),h.Tb(),h.Tb(),h.Pb(14,"app-filter-mat-chip",10),h.Tb(),h.Ub(15,"div"),h.Jc(16,R,5,2,"div",11),h.Tb(),h.Tb(),h.Tb()),2&t){const t=h.uc(10);h.Cb(2),h.nc("formGroup",e.form),h.Cb(5),h.nc("matDatepicker",t),h.Cb(1),h.nc("for",t),h.Cb(6),h.nc("form",e.form.controls.productionLines)("options",e.productionLineOptions),h.Cb(2),h.nc("ngForOf",e.data)}},directives:[O.a,w.c,i.A,i.t,w.d,i.l,w.a,F.c,F.g,L.b,i.d,T.g,i.s,i.j,T.j,F.i,T.f,U.b,w.e,$,n.s,w.b,K.a,K.c,K.e,n.q,J.a,n.t,K.b],styles:["#order .header .subtitle{margin:6px 0 0}#order .content .mat-tab-body-wrapper,#order .content .mat-tab-group,#order .content .tab-content{flex:1 1 auto;max-width:100%}#order .content .tab-content.products .product-row{cursor:pointer}#order .content .tab-content.invoice #invoice.compact{padding:0;overflow:auto;-webkit-overflow-scrolling:touch}#order .content .tab-content.invoice #invoice.compact .invoice-container{padding:16px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card{width:1020px;min-width:1020px;max-width:1020px;padding:64px 88px;overflow:hidden;background:#fff;color:rgba(0,0,0,.87);box-shadow:0 4px 5px -2px rgba(0,0,0,.2),0 7px 10px 1px rgba(0,0,0,.14),0 2px 16px 1px rgba(0,0,0,.12)}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .invoice-date{font-size:14px;color:rgba(0,0,0,.54);margin-bottom:32px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .client .invoice-number{font-size:18px;padding-bottom:2px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .client .invoice-number .title{color:rgba(0,0,0,.54)}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .client .invoice-number .number{padding-left:6px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .client .due-date{font-size:18px;padding-bottom:16px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .client .due-date .title{color:rgba(0,0,0,.54)}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .client .due-date .date{padding-left:6px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .client .info{color:rgba(0,0,0,.54);line-height:22px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .issuer{margin-right:-88px;padding-right:66px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .issuer .logo{width:96px;padding:0 8px;border-right:1px solid hsla(0,0%,100%,.7)}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .issuer .info{padding:16px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table{margin-top:64px;font-size:15px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table thead tr th:first-child{padding-left:8px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table thead tr th:last-child{padding-right:8px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table tbody tr td{border-color:rgba(0,0,0,.12)}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table tbody tr td:first-child{padding-left:8px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table tbody tr td:last-child{padding-right:8px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table .title{font-size:16px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table .detail{margin-top:8px;font-size:12px;color:rgba(0,0,0,.54);max-width:360px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer{margin:32px 0 72px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer tr td{text-align:right;font-size:16px;font-weight:600;color:rgba(0,0,0,.54);border-bottom:none;padding:4px 8px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer tr td:first-child{text-align:left}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer tr.discount td{padding-bottom:32px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer tr.total td{padding:24px 8px;border-top:1px solid rgba(0,0,0,.12);font-size:35px;font-weight:300;color:#000}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .footer .note{font-size:15px;font-weight:600;margin-bottom:24px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .footer .logo,#order .content .tab-content.invoice #invoice.compact .invoice-container .card .footer .small-note{-ms-flex:0 1 auto}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .footer .logo{width:32px;min-width:32px;margin-right:24px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .footer .small-note{font-size:12px;font-weight:600;color:rgba(0,0,0,.54);line-height:18px}@media print{#order .content .tab-content.invoice #invoice.compact .invoice-container{padding:0}#order .content .tab-content.invoice #invoice.compact .invoice-container .card{width:100%;min-width:0;background:none;padding:0;box-shadow:none}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .invoice-date{margin-bottom:16pt}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .issuer{padding-right:0;margin-right:0}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table{margin-top:16pt}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table thead tr th{font-size:10pt;max-width:60pt}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table thead tr th:first-child{padding-left:0}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table thead tr th:last-child{padding-right:0}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table tbody tr td:first-child{padding-left:0}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table tbody tr td:last-child{padding-right:0}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table .title{font-size:10pt}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table .detail{margin-top:4pt;font-size:9pt;max-width:none}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer{margin:16pt 0}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer tr td{font-size:13pt;padding:4pt}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer tr td:first-child{text-align:left;padding-left:0}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer tr td:last-child{padding-right:0}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer tr.discount td{padding-bottom:16pt}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer tr.total td{padding:16pt 4pt 0;font-size:16pt}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer tr.total td:first-child{padding-left:0}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer tr.total td:last-child{padding-right:0}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .footer .note{font-size:10pt;margin-bottom:8pt}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .footer .logo{margin-right:8pt}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .footer .small-note{font-size:8pt;line-height:normal}}#order .content .mat-tab-body-content{display:flex}#order .content .mat-tab-label{height:64px}#order .content table{table-layout:fixed}.mat-card-title-slim{margin-bottom:unset!important}"],encapsulation:2,data:{animation:p.a}}),t})();var H=o("5HBU"),B=o("d3UM"),E=o("+0xr"),W=o("wZkO"),X=o("yPKA");const Q=[F.e,B.b,D.p,U.c,E.l,K.d,W.c,z.b,K.d,T.i,L.c],_=[{path:"",component:q}];let Z=(()=>{class t{}return t.\u0275mod=h.Mb({type:t}),t.\u0275inj=h.Lb({factory:function(e){return new(e||t)},imports:[[f.l.forChild(_),n.c,x.b,H.a,i.x,i.n,X.a,Q]]}),t})()}}]);