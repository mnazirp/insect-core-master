!function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function n(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{rz4i:function(e,o,i){"use strict";i.r(o),i.d(o,"DashboardSopModule",(function(){return ct}));var c,a=i("ofXK"),r=i("3Pt+"),d=i("XNiG"),l=i("PqYM"),p=i("eIep"),s=i("un/a"),b=i("w1tV"),v=i("1G5W"),u=i("PVWW"),f=i("wd/R"),h=i("fXoL"),m=i("tk/3"),g=i("4WDQ"),x=i("tyNb"),y=i("hw3O"),C=i("Rea6"),k=i("sYmb"),O=((c=function(){function e(n,o,i,c){t(this,e),this.http=n,this.snack=o,this.translate=i,this.global=c}return n(e,[{key:"hasCache",value:function(t){return!!localStorage.getItem(this.prefix+t)}},{key:"getCache",value:function(t){var e=localStorage.getItem(this.prefix+t);return JSON.parse(e)}},{key:"setCache",value:function(t,e){var n=JSON.stringify(e);return localStorage.setItem(this.prefix+t,n)}},{key:"prefix",get:function(){return this.global.storagePrefix+"CACHE-"}}]),e}()).\u0275fac=function(t){return new(t||c)(h.Yb(m.b),h.Yb(C.a),h.Yb(k.d),h.Yb(g.a))},c.\u0275prov=h.Kb({token:c,factory:c.\u0275fac,providedIn:"root"}),c),w=i("X3qz"),F=i("EwFO"),L=i("XiUz"),T=i("kmnG"),U=i("qFsG"),S=i("iadO"),P=i("bTqV"),z=i("FtGj"),D=i("/1cH"),I=i("A5z7"),A=i("NFeN"),V=i("FKr1"),$=["inputFilter"];function K(t,e){if(1&t){var n=h.Vb();h.Ub(0,"mat-chip",8),h.cc("removed",(function(){h.yc(n);var t=e.$implicit;return h.gc().remove(t)})),h.Lc(1),h.Ub(2,"mat-icon",9),h.Lc(3,"cancel"),h.Tb(),h.Tb()}if(2&t){var o=e.$implicit;h.nc("selectable",!0)("removable",!0),h.Cb(1),h.Nc(" ",o.label," ")}}function j(t,e){if(1&t&&(h.Ub(0,"mat-option",10),h.Lc(1),h.Tb()),2&t){var n=e.$implicit;h.nc("value",n.value),h.Cb(1),h.Nc(" ",n.label," ")}}var J,G=((J=function(){function e(){t(this,e),this.label="Choose a type",this.placeholder="SOP Types...",this.multiple=!1,this.options=[],this.separatorKeysCodes=[z.g,z.c],this.filterControl=new r.h,this.filteredOptions=[],this.selectedOptions=[]}return n(e,[{key:"ngOnInit",value:function(){this.subValueChanges(),this.filterOptions()}},{key:"ngOnChanges",value:function(t){t.options&&t.options.currentValue&&(this.options=t.options.currentValue,this.filterOptions())}},{key:"subValueChanges",value:function(){var t=this;this.filterControl.valueChanges.subscribe((function(e){t.filterOptions(e)}))}},{key:"filterOptions",value:function(t){t=t||"",this.filteredOptions=this.options.filter((function(e){var n=e.label,o=e.value.toLocaleLowerCase().indexOf(t.toLocaleLowerCase())>-1,i=n.toLocaleLowerCase().indexOf(t.toLocaleLowerCase())>-1;return o||i}))}},{key:"selected",value:function(t){var e=this.form.value||[];e.push(t.option.value),this.form.setValue(e),this.refreshSelectedOptions(),this.openAutocompletePanel(),this.clearInput()}},{key:"clearInput",value:function(){this.filterControl.reset(null),this.inputFilter.nativeElement.value=""}},{key:"openAutocompletePanel",value:function(){var t=this;setTimeout((function(){t.inputAutocomplete.openPanel()}),0)}},{key:"remove",value:function(t){var e=this.form.value||[],n=e.indexOf(t.value);n>=0&&e.splice(n,1),this.form.setValue(e),this.refreshSelectedOptions()}},{key:"refreshSelectedOptions",value:function(){var t=this.form.value||[];this.selectedOptions=this.options.filter((function(e){return t.includes(e.value)}))}}]),e}()).\u0275fac=function(t){return new(t||J)},J.\u0275cmp=h.Ib({type:J,selectors:[["app-filter-mat-chip"]],viewQuery:function(t,e){var n;1&t&&(h.Qc(D.c,!0,D.c),h.Qc($,!0)),2&t&&(h.tc(n=h.dc())&&(e.inputAutocomplete=n.first),h.tc(n=h.dc())&&(e.inputFilter=n.first))},inputs:{label:"label",placeholder:"placeholder",form:"form",multiple:"multiple",options:"options"},features:[h.Ab],decls:14,vars:8,consts:[["appearance","outline",2,"width","100%"],["chipList",""],[3,"selectable","removable","removed",4,"ngFor","ngForOf"],[3,"placeholder","formControl","matAutocomplete","matChipInputFor","matChipInputSeparatorKeyCodes"],["inputAutocomplete","","inputFilter",""],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"selectable","removable","removed"],["matChipRemove",""],[3,"value"]],template:function(t,e){if(1&t&&(h.Ub(0,"mat-form-field",0),h.Ub(1,"mat-label"),h.Lc(2),h.Tb(),h.Ub(3,"mat-chip-list",null,1),h.Jc(5,K,4,3,"mat-chip",2),h.Pb(6,"input",3,4),h.Tb(),h.Ub(9,"mat-autocomplete",5,6),h.cc("optionSelected",(function(t){return e.selected(t)})),h.Jc(11,j,2,2,"mat-option",7),h.Tb(),h.Ub(12,"mat-error"),h.Lc(13,"Required"),h.Tb(),h.Tb()),2&t){var n=h.uc(4),o=h.uc(10);h.Cb(2),h.Mc(e.label),h.Cb(3),h.nc("ngForOf",e.selectedOptions),h.Cb(1),h.nc("placeholder",e.placeholder)("formControl",e.filterControl)("matAutocomplete",o)("matChipInputFor",n)("matChipInputSeparatorKeyCodes",e.separatorKeysCodes),h.Cb(5),h.nc("ngForOf",e.filteredOptions)}},directives:[T.c,T.g,I.c,a.s,r.d,D.c,I.b,r.s,r.i,D.a,T.b,I.a,A.a,I.d,V.o],styles:[""]}),J),Y=i("Wp6s"),M=i("znSr");function N(t,e){if(1&t&&(h.Ub(0,"div"),h.Lc(1),h.Tb()),2&t){var n=e.$implicit,o=h.gc().$implicit,i=h.gc(4);h.Cb(1),h.Oc(" ",n.label,": ",i.getValue(o[n.value])," ")}}function R(t,e){if(1&t){var n=h.Vb();h.Ub(0,"div",20),h.cc("click",(function(){h.yc(n);var t=e.$implicit;return h.gc(4).onClickCard(t)})),h.Ub(1,"div",21),h.Jc(2,N,2,2,"div",11),h.Tb(),h.Tb()}if(2&t){var o=h.gc(2).$implicit;h.Cb(2),h.nc("ngForOf",o.data.template)}}function q(t,e){if(1&t&&(h.Ub(0,"mat-card-content"),h.Ub(1,"div",18),h.Jc(2,R,3,1,"div",19),h.Tb(),h.Tb()),2&t){var n=h.gc().$implicit;h.Cb(2),h.nc("ngForOf",n.data.source)}}var H=function(t){return{"mat-card-title-slim":t}};function E(t,e){if(1&t&&(h.Ub(0,"div",15),h.Ub(1,"mat-card"),h.Ub(2,"mat-card-header"),h.Ub(3,"mat-card-title",16),h.Lc(4),h.Tb(),h.Tb(),h.Jc(5,q,3,1,"mat-card-content",17),h.Tb(),h.Tb()),2&t){var n=e.$implicit;h.Cb(3),h.nc("title",n.key||"form not ready")("ngClass",h.qc(6,H,!n.data.source.length)),h.Cb(1),h.Pc(" ",n.id," ",n.label," (",n.data.source.length,") "),h.Cb(1),h.nc("ngIf",n.data.source.length)}}function B(t,e){if(1&t&&(h.Ub(0,"div"),h.Ub(1,"div",12),h.Ub(2,"div",13),h.Lc(3),h.Tb(),h.Tb(),h.Jc(4,E,6,8,"div",14),h.Tb()),2&t){var n=e.$implicit;h.Cb(3),h.Mc(n.label),h.Cb(1),h.nc("ngForOf",n.sops)}}var W,X,Q=((W=function(){function e(n,o,i,c,a,r){t(this,e),this.http=n,this.global=o,this.router=i,this.formService=c,this.cache=a,this.options=r,this.data=[],this.form=this.getForm(),this.stopPolling=new d.a,this.cacheKey="dashboard-sop",this.productionLineOptions=[],this._unsubscribeAll=new d.a}return n(e,[{key:"ngOnInit",value:function(){var t=this;this.form.valueChanges.subscribe((function(e){return t.onChangeFormValue(e)})),this.startPolling(),this.global.scheduleDashboardRefresh(),this.global.dashboardRefreshSubject.subscribe((function(){t.setDateFilterToday()})),this.setFormTypeOptions()}},{key:"ngOnDestroy",value:function(){this._unsubscribeAll.next(),this._unsubscribeAll.complete(),this.stopPolling.next(),this.global.stopDashboardRefresh()}},{key:"setFormTypeOptions",value:function(){var t=this;this.options.fetchFormTypeOptions().subscribe((function(e){t.productionLineOptions=e}))}},{key:"setCacheFilter",value:function(){this.cache.hasCache(this.cacheKey)&&this.form.setValue(this.cache.getCache(this.cacheKey))}},{key:"startPolling",value:function(){var t=this;this.polling=Object(l.a)(1,15e3).pipe(Object(p.a)((function(){return t.fetchData()})),Object(s.a)(),Object(b.a)(),Object(v.a)(this.stopPolling)),this.polling.subscribe((function(e){return t.handleData(e)}))}},{key:"fetchData",value:function(){var t="/api/".concat(this.global.tenant,"/dashboard/dashboard-sop"),e=this.getBody(),n=this.getOptions();return this.http.post(t,e,n)}},{key:"getBody",value:function(){var t=this.form.controls,e=t.date.value,n=f(e).add(24,"hours"),o=t.productionLines.value,i={timestamp:{}};return i.timestamp.$gte=e,i.timestamp.$lt=n,i.dataRecord={},i.dataRecord.$eq=!0,o&&o.length>0&&(i.productionLine={},i.productionLine.$in=o),{selector:i}}},{key:"getOptions",value:function(){return{headers:this.getHeaders(),params:this.getParams()}}},{key:"getParams",value:function(){return{}}},{key:"getHeaders",value:function(){return{skipLoading:"true"}}},{key:"handleData",value:function(t){this.data=t}},{key:"handleError",value:function(t){console.log(t)}},{key:"getValue",value:function(t){return this.isISO8601(t)?f(t).format("DD MMM YYYY, HH:mm:ss"):t}},{key:"getForm",value:function(){return new r.k({date:new r.h(this.getStartDay()),productionLines:new r.h})}},{key:"getStartDay",value:function(){return f().startOf("day")}},{key:"onChangeFormValue",value:function(t){var e=this;this.cache.setCache(this.cacheKey,t),this.fetchData().subscribe((function(t){return e.handleData(t)}),(function(t){return e.handleError(t)}))}},{key:"isISO8601",value:function(t){return!!/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z/.test(t)&&new Date(t).toISOString()===t}},{key:"onClickCard",value:function(t){var e="/forms/type/".concat(t.productionLine,"/").concat(t.workstationForm,"/edit");this.formService.selectedId=t._id,this.formService.goBackUsingLocation=!0,this.router.navigateByUrl(e)}},{key:"setDateFilterToday",value:function(){this.form.get("date").setValue(this.getStartDay())}}]),e}()).\u0275fac=function(t){return new(t||W)(h.Ob(m.b),h.Ob(g.a),h.Ob(x.h),h.Ob(y.a),h.Ob(O),h.Ob(w.a))},W.\u0275cmp=h.Ib({type:W,selectors:[["app-dashboard-sop"]],decls:17,vars:6,consts:[["fusePerfectScrollbar","",1,"page-layout","blank","p-24"],["fxLayout","column"],["fxLayout","row","fxLayoutGap","24px",3,"formGroup"],["fxLayout","row","fxLayoutGap","12px","fxFlex",""],["appearance","outline","fxFlex",""],["matInput","","formControlName","date",3,"matDatepicker"],["matSuffix","",3,"for"],["picker",""],[2,"padding","0.25em 0.25em calc(21.5px + 0.25em) 0.25em"],["mat-raised-button","","fxFill","","color","accent",3,"click"],["fxFlex","",3,"form","options"],[4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","start center",1,"pb-16"],[1,"h2","secondary-text"],["class","pb-8",4,"ngFor","ngForOf"],[1,"pb-8"],[3,"title","ngClass"],[4,"ngIf"],["fxLayout","row","fxLayoutGap","6px",2,"overflow-x","scroll"],["class","fuse-card","style","cursor: pointer; background-color: #F3F3F3;",3,"click",4,"ngFor","ngForOf"],[1,"fuse-card",2,"cursor","pointer","background-color","#F3F3F3",3,"click"],["fxLayout","column","fxLayoutAlign","start start",1,"p-8"]],template:function(t,e){if(1&t&&(h.Ub(0,"div",0),h.Ub(1,"div",1),h.Ub(2,"form",2),h.Ub(3,"div",3),h.Ub(4,"mat-form-field",4),h.Ub(5,"mat-label"),h.Lc(6,"Choose a date"),h.Tb(),h.Pb(7,"input",5),h.Pb(8,"mat-datepicker-toggle",6),h.Pb(9,"mat-datepicker",null,7),h.Tb(),h.Ub(11,"div",8),h.Ub(12,"button",9),h.cc("click",(function(){return e.setDateFilterToday()})),h.Lc(13," Today "),h.Tb(),h.Tb(),h.Tb(),h.Pb(14,"app-filter-mat-chip",10),h.Tb(),h.Ub(15,"div"),h.Jc(16,B,5,2,"div",11),h.Tb(),h.Tb(),h.Tb()),2&t){var n=h.uc(10);h.Cb(2),h.nc("formGroup",e.form),h.Cb(5),h.nc("matDatepicker",n),h.Cb(1),h.nc("for",n),h.Cb(6),h.nc("form",e.form.controls.productionLines)("options",e.productionLineOptions),h.Cb(2),h.nc("ngForOf",e.data)}},directives:[F.a,L.c,r.A,r.t,L.d,r.l,L.a,T.c,T.g,U.b,r.d,S.g,r.s,r.j,S.j,T.i,S.f,P.b,L.e,G,a.s,L.b,Y.a,Y.c,Y.e,a.q,M.a,a.t,Y.b],styles:["#order .header .subtitle{margin:6px 0 0}#order .content .mat-tab-body-wrapper,#order .content .mat-tab-group,#order .content .tab-content{flex:1 1 auto;max-width:100%}#order .content .tab-content.products .product-row{cursor:pointer}#order .content .tab-content.invoice #invoice.compact{padding:0;overflow:auto;-webkit-overflow-scrolling:touch}#order .content .tab-content.invoice #invoice.compact .invoice-container{padding:16px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card{width:1020px;min-width:1020px;max-width:1020px;padding:64px 88px;overflow:hidden;background:#fff;color:rgba(0,0,0,.87);box-shadow:0 4px 5px -2px rgba(0,0,0,.2),0 7px 10px 1px rgba(0,0,0,.14),0 2px 16px 1px rgba(0,0,0,.12)}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .invoice-date{font-size:14px;color:rgba(0,0,0,.54);margin-bottom:32px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .client .invoice-number{font-size:18px;padding-bottom:2px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .client .invoice-number .title{color:rgba(0,0,0,.54)}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .client .invoice-number .number{padding-left:6px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .client .due-date{font-size:18px;padding-bottom:16px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .client .due-date .title{color:rgba(0,0,0,.54)}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .client .due-date .date{padding-left:6px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .client .info{color:rgba(0,0,0,.54);line-height:22px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .issuer{margin-right:-88px;padding-right:66px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .issuer .logo{width:96px;padding:0 8px;border-right:1px solid hsla(0,0%,100%,.7)}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .issuer .info{padding:16px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table{margin-top:64px;font-size:15px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table thead tr th:first-child{padding-left:8px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table thead tr th:last-child{padding-right:8px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table tbody tr td{border-color:rgba(0,0,0,.12)}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table tbody tr td:first-child{padding-left:8px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table tbody tr td:last-child{padding-right:8px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table .title{font-size:16px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table .detail{margin-top:8px;font-size:12px;color:rgba(0,0,0,.54);max-width:360px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer{margin:32px 0 72px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer tr td{text-align:right;font-size:16px;font-weight:600;color:rgba(0,0,0,.54);border-bottom:none;padding:4px 8px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer tr td:first-child{text-align:left}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer tr.discount td{padding-bottom:32px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer tr.total td{padding:24px 8px;border-top:1px solid rgba(0,0,0,.12);font-size:35px;font-weight:300;color:#000}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .footer .note{font-size:15px;font-weight:600;margin-bottom:24px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .footer .logo,#order .content .tab-content.invoice #invoice.compact .invoice-container .card .footer .small-note{-ms-flex:0 1 auto}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .footer .logo{width:32px;min-width:32px;margin-right:24px}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .footer .small-note{font-size:12px;font-weight:600;color:rgba(0,0,0,.54);line-height:18px}@media print{#order .content .tab-content.invoice #invoice.compact .invoice-container{padding:0}#order .content .tab-content.invoice #invoice.compact .invoice-container .card{width:100%;min-width:0;background:none;padding:0;box-shadow:none}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .invoice-date{margin-bottom:16pt}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .header .issuer{padding-right:0;margin-right:0}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table{margin-top:16pt}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table thead tr th{font-size:10pt;max-width:60pt}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table thead tr th:first-child{padding-left:0}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table thead tr th:last-child{padding-right:0}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table tbody tr td:first-child{padding-left:0}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table tbody tr td:last-child{padding-right:0}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table .title{font-size:10pt}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table .detail{margin-top:4pt;font-size:9pt;max-width:none}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer{margin:16pt 0}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer tr td{font-size:13pt;padding:4pt}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer tr td:first-child{text-align:left;padding-left:0}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer tr td:last-child{padding-right:0}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer tr.discount td{padding-bottom:16pt}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer tr.total td{padding:16pt 4pt 0;font-size:16pt}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer tr.total td:first-child{padding-left:0}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .content .invoice-table-footer tr.total td:last-child{padding-right:0}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .footer .note{font-size:10pt;margin-bottom:8pt}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .footer .logo{margin-right:8pt}#order .content .tab-content.invoice #invoice.compact .invoice-container .card .footer .small-note{font-size:8pt;line-height:normal}}#order .content .mat-tab-body-content{display:flex}#order .content .mat-tab-label{height:64px}#order .content table{table-layout:fixed}.mat-card-title-slim{margin-bottom:unset!important}"],encapsulation:2,data:{animation:u.a}}),W),_=i("5HBU"),Z=i("d3UM"),tt=i("+0xr"),et=i("wZkO"),nt=i("yPKA"),ot=[T.e,Z.b,V.p,P.c,tt.l,Y.d,et.c,A.b,Y.d,S.i,U.c],it=[{path:"",component:Q}],ct=((X=function e(){t(this,e)}).\u0275mod=h.Mb({type:X}),X.\u0275inj=h.Lb({factory:function(t){return new(t||X)},imports:[[x.l.forChild(it),a.c,k.b,_.a,r.x,r.n,nt.a,ot]]}),X)}}])}();