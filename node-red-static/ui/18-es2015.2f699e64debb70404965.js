(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{n9R2:function(e,t,a){"use strict";a.r(t),a.d(t,"ExportModule",(function(){return k}));var n=a("ofXK"),o=a("5HBU"),i=a("sYmb"),r=a("wd/R");const s={lang:"en",data:{SAMPLE:{HELLO:"Hello, World!"},FORM_FIELD:{LABEL:{DATE_RANGE:"Enter a date range (Optional)",DATABASE:"Database",FIELDS:"Fields",SORT_BY:"Sort by",EXPORT:"Export",INCLUDE_METADATA:"Include Metadata",BLUEPRINT_MARKED:"Metadata marked in Blueprint"},DATE_PICKER:{TITLE:{DATE_RANGE:"Date Range (Optional): "}},INPUT:{PLACEHOLDER:{SEARCH_FOR_FORM:"Search for form",START_DATE:"Start date",END_DATE:"End date",FIELDS:"Enter field separated by comma with space behind, eg: timestamp, matingChamber",SORT_BY:"Enter sorts separated by comma with space behind, eg: timestamp:desc, matingChamber:asc"}},SELECT:{OPTION:{CSV:"Export CSV",SHEET:"Export to Google Sheet"}},HINT:{EXAMPLE:"eg:"}},BUTTON:{EXPORT:"Export"}}},c={lang:"my",data:{SAMPLE:{HELLO:"Hello, World!"},FORM_FIELD:{LABEL:{DATE_RANGE:"Masukkan julat tarikh (Tidak Wajib)",DATABASE:"Pangkalan data",FIELDS:"Bidang",SORT_BY:"Disusun mengikut",EXPORT:"Eksport",INCLUDE_METADATA:"Masukkan Metadata",BLUEPRINT_MARKED:"Metadata ditandai dalam Pelan Tindakan"},DATE_PICKER:{TITLE:{DATE_RANGE:"Julat Tarikh (Tidak Wajib): "}},INPUT:{PLACEHOLDER:{SEARCH_FOR_FORM:"Cari borang",START_DATE:"Tarikh mula",END_DATE:"Tarikh tamat",FIELDS:"Masukkan medan yang dipisahkan dengan koma dengan ruang di belakang, misalnya: timestamp, matingChamber",SORT_BY:"Masukkan disusun mengikut dengan dipisahkan dengan koma dengan ruang di belakang, misalnya: timestamp:desc, matingChamber:asc"}},SELECT:{OPTION:{CSV:"Eksport CSV",SHEET:"Eksport ke Google Sheet"}},HINT:{EXAMPLE:"Misalnya:"}},BUTTON:{EXPORT:"Eksport"}}};var l=a("FKr1"),d=a("1yaQ"),p=a("fXoL"),b=a("tk/3");let h=(()=>{class e{constructor(e){this.http=e}exportCsv(e){return this.http.post("/api/export",e,{responseType:"text"})}getNotification(){return this.http.get("/api/notification",{headers:{skipLoading:"true"}})}}return e.\u0275fac=function(t){return new(t||e)(p.Yb(b.b))},e.\u0275prov=p.Kb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var m=a("7Wwi"),u=a("gPJw"),f=a("dNgK"),E=a("XiUz"),T=a("NFeN"),g=a("qFsG"),L=a("3Pt+"),M=a("/1cH"),D=a("kmnG"),C=a("iadO"),O=a("d3UM"),x=a("bSwM"),A=a("bTqV");function F(e,t){if(1&e&&(p.Ub(0,"span"),p.Lc(1),p.Tb()),2&e){const e=p.gc().$implicit;p.Cb(1),p.Nc("(",e.line,")")}}function _(e,t){if(1&e&&(p.Ub(0,"mat-option",28),p.Lc(1),p.Jc(2,F,2,1,"span",29),p.Tb()),2&e){const e=t.$implicit;p.nc("value",e),p.Cb(1),p.Nc(" ",e.form," "),p.Cb(1),p.nc("ngIf",e.line)}}const y={parse:{dateInput:"LL"},display:{dateInput:"DD/MMM/YYYY",monthYearLabel:"MMM YYYY",dateA11yLabel:"LL",monthYearA11yLabel:"MMMM YYYY"}};let S=(()=>{class e{constructor(e,t,a,n,o){this._exportService=e,this.formSelectionService=t,this.changeDetector=a,this._fuseTranslationLoaderService=n,this.snackBar=o,this.filteredForm=[],this.forms=[],this.exportType="GSheet",this.database="insectdata",this.fields="",this.sorts="submission_timestamp:desc",this.includeMetadata=!1,this._fuseTranslationLoaderService.loadTranslations(s,c)}ngOnInit(){this.getForms()}getForms(){this.formSelectionService.getForms().subscribe(e=>{this.apiOutput=e,this.addId()})}addId(){this.forms.push({id:0,form:"Export ALL",line:"",form_version:""});var e=1;for(let t of this.apiOutput){let a=t;a.id=e,e+=1,this.forms.push(a)}this.filteredForm=this.forms,this.changeDetector.detectChanges(),this.focusSearch()}filterMyOptions(e){this.selectedForm=void 0,this.filteredForm=this.forms.filter(t=>t.id.toString().indexOf(e)>-1||t.form.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1)}displayWith(e){return e?e.form:""}selectForm(e){this.selectedForm=e,this.selectedForm&&"Export ALL"===this.selectedForm.form&&(this.exportType="GSheet")}focusSearch(){document.getElementById("searchInput").focus()}generateBody(){let e,t="",a=!1,n=r().utcOffset("+8").format("HHmmss_DDMMyy");this.selectedForm&&"Export ALL"===this.selectedForm.form?(a=!0,n+="-all_form"):(t=`workstationForm=${this.selectedForm.form}, productionLine=${this.selectedForm.line}`,n+=`-${this.selectedForm.line}_${this.selectedForm.form}`),null!=this.startDate&&(t=t+", submission_timestamp>="+this.startDate.startOf("day").utcOffset("+8").toISOString(),null!=this.endDate&&(t=t+", submission_timestamp<="+this.endDate.endOf("day").utcOffset("+8").toISOString()));let o="";null!=this.startDate&&(o="-"+this.startDate.format("DDMMyy"),null!=this.endDate&&(o=o+"_to_"+this.endDate.format("DDMMyy")),n+=o);let i={exportAll:a,filename:n,type:this.exportType,database:this.database,selectors:t,fields:this.fields,sort:this.sorts,includeMetadata:this.includeMetadata};a&&(e=this.forms.splice(0,1),i.availableForms=this.forms),this._exportService.exportCsv(i).subscribe(e=>{this.snackBar.open("Exporting Data","Close",{duration:2e3})},e=>{console.log(e),this.snackBar.open(e.error)}),a&&this.forms.splice(0,0,e[0])}closeCalendar(e){console.log(e)}}return e.\u0275fac=function(t){return new(t||e)(p.Ob(h),p.Ob(m.a),p.Ob(p.h),p.Ob(u.a),p.Ob(f.a))},e.\u0275cmp=p.Ib({type:e,selectors:[["app-export"]],features:[p.Bb([{provide:l.c,useClass:d.c,deps:[l.f,d.a]},{provide:l.e,useValue:y}])],decls:54,vars:45,consts:[[1,"page-layout","simple","fullwidth"],[1,"content","p-24"],["fxLayout","row",2,"padding","5%"],["fxLayout","column","fxFlex","100"],["fxLayout","row","fxLayoutAlign","center center","fxFlex","",1,"ml-sm-32"],[1,"search-wrapper","mt-16","mt-sm-0"],["fxFlex","","fxLayout","row","fxLayoutAlign","start center",1,"search"],["matInput","","id","searchInput",3,"ngModel","placeholder","matAutocomplete","ngModelChange"],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["fxLayout","column","fxFlex","",1,"ml-sm-32"],["fxLayout","row"],["appearance","outline","fxFlex","50",2,"margin-right","1%"],[3,"rangePicker","click"],["tabindex","-1","readonly","","matStartDate","",3,"ngModel","placeholder","ngModelChange"],["tabindex","-1","readonly","","matEndDate","",3,"ngModel","placeholder","ngModelChange"],["matSuffix","",3,"for","focusin"],[3,"keydown.enter"],["picker",""],["appearance","outline","fxFlex","50",2,"margin-left","1%"],["name","export",3,"ngModel","disabled","ngModelChange"],["value","GSheet"],["value","csv"],["fxLayout","column",2,"margin-bottom","12px"],[3,"ngModel","ngModelChange"],[2,"font-size","smaller"],["mat-raised-button","","color","accent","fxFlex","10",3,"disabled","click"],[3,"value"],[4,"ngIf"]],template:function(e,t){if(1&e){const e=p.Vb();p.Ub(0,"div",0),p.Ub(1,"div",1),p.Ub(2,"div",2),p.Ub(3,"div",3),p.Ub(4,"div",4),p.Ub(5,"div",5),p.Ub(6,"div",6),p.Ub(7,"mat-icon"),p.Lc(8,"search"),p.Tb(),p.Ub(9,"input",7),p.cc("ngModelChange",(function(e){return t.searchWord=e}))("ngModelChange",(function(e){return t.filterMyOptions(e)})),p.hc(10,"translate"),p.Tb(),p.Ub(11,"mat-autocomplete",8,9),p.cc("optionSelected",(function(e){return t.selectForm(e.option.value)})),p.Jc(13,_,3,3,"mat-option",10),p.Tb(),p.Tb(),p.Tb(),p.Tb(),p.Ub(14,"div",11),p.Ub(15,"h3"),p.Lc(16),p.hc(17,"translate"),p.Tb(),p.Ub(18,"div",12),p.Ub(19,"mat-form-field",13),p.Ub(20,"mat-label"),p.Lc(21),p.hc(22,"translate"),p.Tb(),p.Ub(23,"mat-date-range-input",14),p.cc("click",(function(){return p.yc(e),p.uc(30).open()})),p.Ub(24,"input",15),p.cc("ngModelChange",(function(e){return t.startDate=e})),p.hc(25,"translate"),p.Tb(),p.Ub(26,"input",16),p.cc("ngModelChange",(function(e){return t.endDate=e})),p.hc(27,"translate"),p.Tb(),p.Tb(),p.Ub(28,"mat-datepicker-toggle",17),p.cc("focusin",(function(){return p.yc(e),p.uc(30).open()})),p.Tb(),p.Ub(29,"mat-date-range-picker",18,19),p.cc("keydown.enter",(function(e){return t.closeCalendar(e)})),p.Tb(),p.Tb(),p.Lc(31," \xa0 "),p.Ub(32,"mat-form-field",20),p.Ub(33,"mat-label"),p.Lc(34),p.hc(35,"translate"),p.Tb(),p.Ub(36,"mat-select",21),p.cc("ngModelChange",(function(e){return t.exportType=e})),p.Ub(37,"mat-option",22),p.Lc(38),p.hc(39,"translate"),p.Tb(),p.Ub(40,"mat-option",23),p.Lc(41),p.hc(42,"translate"),p.Tb(),p.Tb(),p.Tb(),p.Tb(),p.Ub(43,"div",24),p.Ub(44,"mat-checkbox",25),p.cc("ngModelChange",(function(e){return t.includeMetadata=e})),p.Lc(45),p.hc(46,"translate"),p.Tb(),p.Ub(47,"span",26),p.Lc(48),p.hc(49,"translate"),p.Tb(),p.Tb(),p.Ub(50,"div",12),p.Ub(51,"button",27),p.cc("click",(function(){return t.generateBody()})),p.Lc(52),p.hc(53,"translate"),p.Tb(),p.Tb(),p.Tb(),p.Tb(),p.Tb(),p.Tb(),p.Tb()}if(2&e){const e=p.uc(12),a=p.uc(30);p.Cb(9),p.oc("placeholder",p.ic(10,23,"FORM_FIELD.INPUT.PLACEHOLDER.SEARCH_FOR_FORM")),p.nc("ngModel",t.searchWord)("matAutocomplete",e),p.Cb(2),p.nc("displayWith",t.displayWith),p.Cb(2),p.nc("ngForOf",t.filteredForm),p.Cb(3),p.Mc(p.ic(17,25,"FORM_FIELD.DATE_PICKER.TITLE.DATE_RANGE")),p.Cb(5),p.Mc(p.ic(22,27,"FORM_FIELD.LABEL.DATE_RANGE")),p.Cb(2),p.nc("rangePicker",a),p.Cb(1),p.oc("placeholder",p.ic(25,29,"FORM_FIELD.INPUT.PLACEHOLDER.START_DATE")),p.nc("ngModel",t.startDate),p.Cb(2),p.oc("placeholder",p.ic(27,31,"FORM_FIELD.INPUT.PLACEHOLDER.END_DATE")),p.nc("ngModel",t.endDate),p.Cb(2),p.nc("for",a),p.Cb(6),p.Mc(p.ic(35,33,"FORM_FIELD.LABEL.EXPORT")),p.Cb(2),p.nc("ngModel",t.exportType)("disabled",t.selectedForm&&"Export ALL"===t.selectedForm.form),p.Cb(2),p.Nc(" ",p.ic(39,35,"FORM_FIELD.SELECT.OPTION.SHEET")," "),p.Cb(3),p.Nc(" ",p.ic(42,37,"FORM_FIELD.SELECT.OPTION.CSV")," "),p.Cb(3),p.nc("ngModel",t.includeMetadata),p.Cb(1),p.Nc(" ",p.ic(46,39,"FORM_FIELD.LABEL.INCLUDE_METADATA")," "),p.Cb(3),p.Nc("* ",p.ic(49,41,"FORM_FIELD.LABEL.BLUEPRINT_MARKED"),""),p.Cb(3),p.nc("disabled",!t.selectedForm||!t.database||!t.exportType),p.Cb(1),p.Nc(" ",p.ic(53,43,"BUTTON.EXPORT")," ")}},directives:[E.c,E.a,E.b,T.a,g.b,L.d,M.c,L.s,L.v,M.a,n.s,D.c,D.g,C.d,C.l,C.k,C.j,D.i,C.e,O.a,l.o,x.a,A.b,n.t],pipes:[i.c],styles:[".search-wrapper[_ngcontent-%COMP%]{background-color:#fff;width:100%;max-width:480px;border-radius:28px;overflow:hidden;box-shadow:0 2px 1px -1px rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 1px 3px 0 rgba(0,0,0,.12)}.search-wrapper[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{width:100%;height:48px;line-height:48px;padding:0 18px}.search-wrapper[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;height:48px;min-height:48px;max-height:48px;padding:0 16px;border:none;outline:none}"]}),e})();var R=a("tyNb");const I=[{path:"",component:S}];let k=(()=>{class e{}return e.\u0275mod=p.Mb({type:e}),e.\u0275inj=p.Lb({factory:function(t){return new(t||e)},imports:[[n.c,R.l.forChild(I),i.b,o.a,M.b,T.b,C.i,D.e,g.c,O.b,A.c,x.b]]}),e})()}}]);